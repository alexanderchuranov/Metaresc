name: ci

on: [ push, pull_request ]

jobs:

  freebsd-gcc:
    runs-on: macos-12
    name: FreeBSD VM in Macos
    steps:
      - uses: actions/checkout@v2
      - name: FreeBSD with gcc
        uses: vmactions/freebsd-vm@v0
        with:
          usesh: true
          prepare: pkg install -y git autoconf automake libtool pkgconf flex bison libxml2 check
          run: |
            git config --global --add safe.directory `pwd`
            git submodule update --init --recursive --remote
            sed -i.bak -e "s/test_dwarfdumpPE.sh test_dwarfdumpMacos.sh//" libdwarf-code/test/Makefile.am
            ./autogen.sh
            ./configure
            make -j 4 check
